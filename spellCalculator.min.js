class Spell{constructor(e,l,t,a,s){this.baseDamage=e,this.scalingDamage=l,this.spellSlot=t,this.aoe=a,this.concentration=void 0!==s&&s}calcDamage(e,l){return Math.floor(this.baseDamage+(e-this.spellSlot)*this.scalingDamage)*(this.aoe?2:1)}calcDamageByRound(e,l){return 0==l?this.calcDamage(e):0}}class Cantrip extends Spell{constructor(e,l,t){super(e,l,0,t,!1)}calcDamage(e,l){return Math.floor(this.baseDamage+this.scalingDamage*getSpellCasterLevelModification())*(this.aoe?2:1)}}class ComplexSpell extends Spell{constructor(e,l){super(0,0,e,!1,!1),this.damageFormula=l}calcDamage(e,l){return this.damageFormula(e)}}class ModifierDependentCantrip extends Cantrip{constructor(e){super(0,0,!1),this.damageFormula=e}calcDamage(e,l){return this.damageFormula(getSpellCastingModifier(),getSpellCasterLevelModification())}}class DoTSpell extends Spell{constructor(e,l,t,a,s){super(0,0,e,!1,l),void 0===s&&(s=new Spell(0,0,0,!1,!1)),this.spells=[t,a,s]}calcDamage(e,l){let t=0;for(var a=0;a<3-l;a++)t+=this.spells[a].calcDamage(e,null);return t}calcDamageByRound(e,l){return l>2||l<0?0:this.spells[l].calcDamage(e,null)}}function getSpellCasterLevelModification(){let e=parseInt(document.getElementById("scl").value);return Math.floor((e+1)/6)}function getSpellCastingModifier(){return parseInt(document.getElementById("scm").value)}Map.prototype.addSpells=function(){return addSpellsToMap(this,document.getElementById("wotc").checked,document.getElementById("wc5e").checked,document.getElementById("coa").checked)};let spellMap=null,select=null,iSelect1=null,iSelect2=null,iSelect3=null;function calculateSpellList(e){document.getElementById(e).checked&&("coa"==e?document.getElementById("wc5e").checked=!1:"wc5e"==e&&(document.getElementById("coa").checked=!1));let l=select?.selected(),t=iSelect1?.selected(),a=iSelect2?.selected(),s=iSelect3?.selected();updateSpellsInSelect(),l&&select.set(l),t&&iSelect1.set(t),a&&iSelect2.set(a),s&&iSelect3.set(s),calculateSpellDamage(),Calculate()}function spellListSelect(){return spellArray=Array.from(spellMap.keys(),(e=>({value:e,text:e}))),[{label:"Cantrips",options:spellArray.filter((e=>0==spellMap.get(e.text).spellSlot))},{label:"Level 1",options:spellArray.filter((e=>1==spellMap.get(e.text).spellSlot))},{label:"Level 2",options:spellArray.filter((e=>2==spellMap.get(e.text).spellSlot))},{label:"Level 3",options:spellArray.filter((e=>3==spellMap.get(e.text).spellSlot))},{label:"Level 4",options:spellArray.filter((e=>4==spellMap.get(e.text).spellSlot))},{label:"Level 5",options:spellArray.filter((e=>5==spellMap.get(e.text).spellSlot))},{label:"Level 6",options:spellArray.filter((e=>6==spellMap.get(e.text).spellSlot))},{label:"Level 7",options:spellArray.filter((e=>7==spellMap.get(e.text).spellSlot))},{label:"Level 8",options:spellArray.filter((e=>8==spellMap.get(e.text).spellSlot))},{label:"Level 9",options:spellArray.filter((e=>9==spellMap.get(e.text).spellSlot))}]}function spellListSelectNoCantrips(){return spellArray=Array.from(spellMap.keys(),(e=>({value:e,text:e}))),[{label:"Level 1",options:spellArray.filter((e=>1==spellMap.get(e.text).spellSlot))},{label:"Level 2",options:spellArray.filter((e=>2==spellMap.get(e.text).spellSlot))},{label:"Level 3",options:spellArray.filter((e=>3==spellMap.get(e.text).spellSlot))},{label:"Level 4",options:spellArray.filter((e=>4==spellMap.get(e.text).spellSlot))},{label:"Level 5",options:spellArray.filter((e=>5==spellMap.get(e.text).spellSlot))},{label:"Level 6",options:spellArray.filter((e=>6==spellMap.get(e.text).spellSlot))},{label:"Level 7",options:spellArray.filter((e=>7==spellMap.get(e.text).spellSlot))},{label:"Level 8",options:spellArray.filter((e=>8==spellMap.get(e.text).spellSlot))},{label:"Level 9",options:spellArray.filter((e=>9==spellMap.get(e.text).spellSlot))}]}function addSpellsToSelect(){spellMap=(new Map).addSpells(),select=new SlimSelect({select:"#spellsSelect",data:spellListSelect(),onChange:function(){calculateSpellDamage()}}),iSelect1=new SlimSelect({select:"#innateSpellsSelect1",data:spellListSelectNoCantrips(),onChange:function(){calculateSpellDamage()}}),iSelect2=new SlimSelect({select:"#innateSpellsSelect2",data:spellListSelectNoCantrips(),onChange:function(){calculateSpellDamage()}}),iSelect3=new SlimSelect({select:"#innateSpellsSelect3",data:spellListSelectNoCantrips(),onChange:function(){calculateSpellDamage()}})}function updateSpellsInSelect(){spellMap=(new Map).addSpells(),select.setData(spellListSelect()),iSelect1.setData(spellListSelectNoCantrips()),iSelect2.setData(spellListSelectNoCantrips()),iSelect3.setData(spellListSelectNoCantrips())}function setSpellDamage(e,l){document.getElementById("spellDmg1").innerHTML=e[0],document.getElementById("spellDmg2").innerHTML=e[1],document.getElementById("spellDmg3").innerHTML=e[2],document.getElementById("spellUsed1").innerHTML=l[0],document.getElementById("spellUsed2").innerHTML=l[1],document.getElementById("spellUsed3").innerHTML=l[2],history.pushState({},"WC5e CR Calculator","?"+generateUrl())}function calculateSpellDamage(){let e=[parseInt(document.getElementById("ss1").value),parseInt(document.getElementById("ss2").value),parseInt(document.getElementById("ss3").value)];if(!select)return setSpellDamage([0,0,0],["","",""]);let l=select.selected(),t=iSelect1.selected().concat(iSelect2.selected(),iSelect2.selected(),iSelect3.selected(),iSelect3.selected(),iSelect3.selected());if(0==l.length&&0==t.length)return setSpellDamage([0,0,0],["","",""]);let a=[0,0,0],s=["","",""];for(var p=0;p<3&&(0!=l.length||0!=t.length);p++){let c=0,o="",r=!1;if(l.forEach((l=>{let t=spellMap.get(l);t.spellSlot<=e[p]&&(spelldmg=t.calcDamage(e[p],p))>c&&(c=spelldmg,o=l)})),t.forEach((e=>{let l=spellMap.get(e),t=l.spellSlot;(spelldmg=l.calcDamage(t,p))>c&&(c=spelldmg,o=e,r=!0)})),c>0){let l=spellMap.get(o);for(var n=0;n<3-p;n++){let t=r?l.spellSlot:e[p];(spellDamage=l.calcDamageByRound(t,n))>0&&(a[p+n]+=spellDamage,s[p+n]=`${o}${r?" (Innate)":""} (${0==n?"":"DoT, "}${spellDamage})${""==s[p+n]?"":" + "}${s[p+n]}`)}}if(r){let e=t.indexOf(o);t.splice(e,1)}}setSpellDamage(a,s)}function transferDamage(){let e=document.getElementById("spellDmg1").innerHTML,l=document.getElementById("spellDmg2").innerHTML,t=document.getElementById("spellDmg3").innerHTML;return document.getElementById("pDmg1").value=e,document.getElementById("pDmg2").value=l,document.getElementById("pDmg3").value=t,document.getElementById("pDmg4").value=0,document.getElementById("pDmg5").value=0,document.getElementById("pDmg6").value=0,Calculate(),!1}

function untangleDiceExpression(e){return e.replace(/(\d+)d(\d+)/g,function(e,t,n){return""+Math.floor((n/2+.5)*t)})}function fillOut(e){if(e){var n=decodeURI(e).split(";");if("v2"!=n[0]&&"v3"!=n[0])legacyFillOut(e);else{"v3"==n[0]&&(document.getElementById("legendaryDragon").checked="3"===n[1],document.getElementById("2024Table").checked=["2","3"].includes(n[1]),document.getElementById("legendaryDragon").disabled=!["2","3"].includes(n[1]),document.getElementById("wc5eTable").checked="1"===n[1],document.getElementById("officialTable").checked="0"===n[1],n.splice(1,1)),document.getElementById("targetCR").selectedIndex=n[1],document.getElementById("actualAC").value=n[2],document.getElementById("actualHP").value=n[3],document.getElementById("actualAB").value=n[4],document.getElementById("actualSDC").value=n[5],document.getElementById("pDmg1").value=n[6],document.getElementById("pDmg2").value=n[7],document.getElementById("pDmg3").value=n[8],document.getElementById("pDmg4").value=n[9],document.getElementById("pDmg5").value=n[10],document.getElementById("pDmg6").value=n[11],document.getElementById("damageResistance").checked=n[12],document.getElementById("damageImmunity").checked=n[13],document.getElementById("flySpeedAndRangedAttack").checked=n[14],document.getElementById("savingThrowProficiencies").checked=n[15],document.getElementById("savingThrowProficiencyCount").value=n[16],document.getElementById("aggressive").checked=n[17],document.getElementById("ambusher").checked=n[18],document.getElementById("avoidance").checked=n[19],document.getElementById("bloodFrenzy").checked=n[20],document.getElementById("constrict").checked=n[21],document.getElementById("damageTransfer").checked=n[22],document.getElementById("frightfulPresence").checked=n[23],document.getElementById("horrifyingVisage").checked=n[24],document.getElementById("legendaryResistance").checked=n[25],document.getElementById("legendaryResistanceUses").value=n[26],document.getElementById("magicResistance").checked=n[27],document.getElementById("nimbleEscape").checked=n[28],document.getElementById("packTactics").checked=n[29],document.getElementById("parry").checked=n[30],document.getElementById("possession").checked=n[31],document.getElementById("rampage").checked=n[32],document.getElementById("regeneration").checked=n[33],document.getElementById("regenerationValue").value=n[34],document.getElementById("relentless").checked=n[35],document.getElementById("shadowStealth").checked=n[36],document.getElementById("stench").checked=n[37],document.getElementById("superiorInvisibility").checked=n[38],document.getElementById("undeadFortitude").checked=n[39],document.getElementById("web").checked=n[40],document.getElementById("ss1").value=n[41],document.getElementById("ss2").value=n[42],document.getElementById("ss3").value=n[43],document.getElementById("scl").value=n[44],document.getElementById("wc5e").checked="1"==n[45],document.getElementById("coa").checked="1"==n[46]&&"1"!=n[45],document.getElementById("wotc").checked="1"==n[47],document.getElementById("scm").value=n[48],addSpellsToSelect();var a=49,d=n.indexOf("is1"),c=n.indexOf("is2"),o=n.indexOf("is3");if(-1==d){var t=[n.length-a];for(let e=a;e<n.length;e++)t[e-a]=decodeURIComponent(n[e]);select.set(t)}else{let t=[d-a];for(let e=a;e<d;e++)t[e-a]=decodeURIComponent(n[e]);select.set(t),t=[c-d-1];for(let e=d+1;e<c;e++)t[e-d-1]=decodeURIComponent(n[e]);iSelect1.set(t),t=[o-c-1];for(let e=c+1;e<o;e++)t[e-c-1]=decodeURIComponent(n[e]);iSelect2.set(t),t=[n.length-o-1];for(let e=o+1;e<n.length;e++)t[e-o-1]=decodeURIComponent(n[e]);iSelect3.set(t)}}calculateSpellDamage(),Calculate()}else addSpellsToSelect()}function legacyFillOut(e){var n=e.split(";");document.getElementById("targetCR").selectedIndex=n[0],document.getElementById("actualAC").value=n[1],document.getElementById("actualHP").value=n[2],document.getElementById("actualAB").value=n[3],document.getElementById("actualSDC").value=n[4],document.getElementById("pDmg1").value="0"===n[6]?n[5]:n[5]+"+"+n[6],document.getElementById("pDmg2").value="0"===n[8]?n[7]:n[7]+"+"+n[8],document.getElementById("pDmg3").value="0"===n[10]?n[9]:n[9]+"+"+n[10],document.getElementById("pDmg4").value="0"===n[12]?n[11]:n[11]+"+"+n[12],document.getElementById("pDmg5").value="0"===n[14]?n[13]:n[13]+"+"+n[14],document.getElementById("pDmg6").value="0"===n[16]?n[15]:n[15]+"+"+n[16],document.getElementById("damageResistance").checked=n[17],document.getElementById("damageImmunity").checked=n[18],document.getElementById("flySpeedAndRangedAttack").checked=n[19],document.getElementById("savingThrowProficiencies").checked=n[20],document.getElementById("savingThrowProficiencyCount").value=n[21],document.getElementById("aggressive").checked=n[22],document.getElementById("ambusher").checked=n[23],document.getElementById("avoidance").checked=n[24],document.getElementById("bloodFrenzy").checked=n[25],document.getElementById("constrict").checked=n[26],document.getElementById("damageTransfer").checked=n[27],document.getElementById("frightfulPresence").checked=n[28],document.getElementById("horrifyingVisage").checked=n[29],document.getElementById("legendaryResistance").checked=n[30],document.getElementById("legendaryResistanceUses").value=n[31],document.getElementById("magicResistance").checked=n[32],document.getElementById("nimbleEscape").checked=n[33],document.getElementById("packTactics").checked=n[34],document.getElementById("parry").checked=n[35],document.getElementById("possession").checked=n[36],document.getElementById("rampage").checked=n[37],document.getElementById("regeneration").checked=n[38],document.getElementById("regenerationValue").value=n[39],document.getElementById("relentless").checked=n[40],document.getElementById("shadowStealth").checked=n[41],document.getElementById("stench").checked=n[42],document.getElementById("superiorInvisibility").checked=n[43],document.getElementById("undeadFortitude").checked=n[44],document.getElementById("web").checked=n[45],document.getElementById("ss1").value=n[46],document.getElementById("ss2").value=n[47],document.getElementById("ss3").value=n[48],document.getElementById("scl").value=n[49];let a=50;50<n.length&&/^-?\d+$/.test(n[50])?(document.getElementById("wc5e").checked="1"==n[50],document.getElementById("coa").checked="1"==n[51]&&"1"!=n[50],document.getElementById("wotc").checked="1"==n[52],a=53):(document.getElementById("wc5e").checked=1,document.getElementById("coa").checked=0,document.getElementById("wotc").checked=1),53<n.length&&/^-?\d+$/.test(n[53])?(document.getElementById("scm").value=n[53],a=54):document.getElementById("scm").value=3,addSpellsToSelect();var d=n.indexOf("is1"),c=n.indexOf("is2"),o=n.indexOf("is3");if(-1==d){var t=[n.length-a];for(let e=a;e<n.length;e++)t[e-a]=decodeURIComponent(n[e]);select.set(t)}else{let t=[d-a];for(let e=a;e<d;e++)t[e-a]=decodeURIComponent(n[e]);select.set(t),t=[c-d-1];for(let e=d+1;e<c;e++)t[e-d-1]=decodeURIComponent(n[e]);iSelect1.set(t),t=[o-c-1];for(let e=c+1;e<o;e++)t[e-c-1]=decodeURIComponent(n[e]);iSelect2.set(t),t=[n.length-o-1];for(let e=o+1;e<n.length;e++)t[e-o-1]=decodeURIComponent(n[e]);iSelect3.set(t)}}function generateUrl(){return"v3;"+(document.getElementById("2024Table").checked?""+(2+document.getElementById("legendaryDragon").checked):document.getElementById("wc5eTable").checked?"1":"0")+";"+document.getElementById("targetCR").selectedIndex+";"+document.getElementById("actualAC").value+";"+document.getElementById("actualHP").value+";"+document.getElementById("actualAB").value+";"+document.getElementById("actualSDC").value+";"+document.getElementById("pDmg1").value+";"+document.getElementById("pDmg2").value+";"+document.getElementById("pDmg3").value+";"+document.getElementById("pDmg4").value+";"+document.getElementById("pDmg5").value+";"+document.getElementById("pDmg6").value+";"+(document.getElementById("damageResistance").checked?"1":"")+";"+(document.getElementById("damageImmunity").checked?"1":"")+";"+(document.getElementById("flySpeedAndRangedAttack").checked?"1":"")+";"+(document.getElementById("savingThrowProficiencies").checked?"1":"")+";"+document.getElementById("savingThrowProficiencyCount").value+";"+(document.getElementById("aggressive").checked?"1":"")+";"+(document.getElementById("ambusher").checked?"1":"")+";"+(document.getElementById("avoidance").checked?"1":"")+";"+(document.getElementById("bloodFrenzy").checked?"1":"")+";"+(document.getElementById("constrict").checked?"1":"")+";"+(document.getElementById("damageTransfer").checked?"1":"")+";"+(document.getElementById("frightfulPresence").checked?"1":"")+";"+(document.getElementById("horrifyingVisage").checked?"1":"")+";"+(document.getElementById("legendaryResistance").checked?"1":"")+";"+document.getElementById("legendaryResistanceUses").value+";"+(document.getElementById("magicResistance").checked?"1":"")+";"+(document.getElementById("nimbleEscape").checked?"1":"")+";"+(document.getElementById("packTactics").checked?"1":"")+";"+(document.getElementById("parry").checked?"1":"")+";"+(document.getElementById("possession").checked?"1":"")+";"+(document.getElementById("rampage").checked?"1":"")+";"+(document.getElementById("regeneration").checked?"1":"")+";"+document.getElementById("regenerationValue").value+";"+(document.getElementById("relentless").checked?"1":"")+";"+(document.getElementById("shadowStealth").checked?"1":"")+";"+(document.getElementById("stench").checked?"1":"")+";"+(document.getElementById("superiorInvisibility").checked?"1":"")+";"+(document.getElementById("undeadFortitude").checked?"1":"")+";"+(document.getElementById("web").checked?"1":"")+";"+document.getElementById("ss1").value+";"+document.getElementById("ss2").value+";"+document.getElementById("ss3").value+";"+document.getElementById("scl").value+";"+(document.getElementById("wc5e").checked?"1":"0")+";"+(document.getElementById("coa").checked?"1":"0")+";"+(document.getElementById("wotc").checked?"1":"0")+";"+document.getElementById("scm").value+";"+select.selected().join(";")+";is1;"+iSelect1.selected().join(";")+";is2;"+iSelect2.selected().join(";")+";is3;"+iSelect3.selected().join(";")}function Roll(e,t,n,a=!0){if(void 0!==n&&!isNaN(n)||(n=0),e<1||t<1||e<=n)return 0;for(var d=[],c=0;c<e;c++)d.push(Math.ceil(Math.random()*t));d.sort();for(c=0;c<n;c++)a?d.shift():d.pop();for(var o=0,c=0;c<d.length;c++)o+=d[c];return o}function popup(e){switch(e){case"traits":window.open("","","height=400,width=600").document.write("<div style='width:100%;height:100%;' onclick='window.close()'><h2><i>Where are all the other traits?</i></h2><p>You have probably noticed that the traits included in the list of checkboxes here is far from exhaustive&mdash;there is a reason for this:</p><p>According to the trait inventory in the DMG (see pp.280&ndash;281 for the full list), many traits have no effect on a creature's CR, so they are not listed here.</p><p>Furthermore, many of the traits that <i>do</i> affect CR still aren't included, because the extent of their effect is to increase the monster's damage output for one or more turns by either a specified amount, or by granting the monster an extra attack (<b><i>Brute</i></b>, <b><i>Surprise Attack</i></b>, and <b><i>Trampling Charge</i></b> would be examples of this).</p><p>In these cases, you simply add the damage specified to the monster's damage-per-round as makes sense for the trait, and thus eliminate the need for a corresponding trait button.</p><p><small><i>(Click anywhere to close)</i></small></div>");break;case"tutorial":window.open("","","height=648,width=1152").document.write("<div style='width:100%;height:100%;' onclick='window.close()'><h2><i>What is This and How Do I Use It?</i></h2><p style='position:relative;top:-12px;'><small><i>(Click anywhere to close)</i></small></p><p>This is a CR Calculator for Dungeons and Dragons 5th edition. You can find a full explanation of how all of these calculations work in chapter 9 of the <i>Dungeon Master's Guide</i>, as the calculations done by this tool are all completely based on the steps and guidelines laid out there.</p><h2><i>Step 1: Target CR Range</i></h2><p>In the 'Target CR Range' dropdown at the top of the tool, simply choose the range of challenge ratings where you want or expect the creature to fall.</p><p>Several of the calculations done during this process will change depending on the desired final CR of the creature, so choose this first, even if it's just a guess&mdash;you can always come back and change it later if necessary.</p><p>If the CR falls outside the range you chose, the box will turn yellow, notifying you of the discrepancy. Note that because of the way the CR range affects some of the stat calculations, there is an occasional possibility for the target CR to show as incorrect no matter which range you choose&mdash;specifically when the creature falls very near the border of two of the specified ranges. You may have to alter some stats to stabilize the CR, or simply average the two reported CRs given when you select the two ranges.</p><h2><i>Step 2: Defensive CR</i></h2><p>Input the creature's AC as written on the stat block into the 'Actual AC' box, then do the same for the creature's HP.</p><p>You may notice that the 'Effective' AC and HP to the right of your inputs may differ: this is okay. There are certain attributes and traits that are calculated by changing the creature's statistics superficially for the purposes of the calculation, but which don't actually affect what's written on the stat block. You can safely ignore these 'Effective' stats if you wish: they are there for your own information only, and have no bearing on the creature in-game.</p><h2><i>Step 3: Offensive CR</i></h2><p>As you did with the defensive stats, input the creature's attack bonus (the number that precedes 'to hit' on the creature's attacks; omit the plus sign) for the attack or attacks it will be using most often&mdash;keep in mind this might be its spellcasting attack bonus, if it will be relying more heavily on spellcasting.</p><p>Next, use the boxes to the right of the 'Damage per Round' readout to input the most damage per round it can input throughout the fight. The damage boxes takes a mathematical expression. You can ignore this and just fill in a number, but if you want to track different damage sources separately you can do so by plussing them together. Likewise, the average damage per turn calculation only recognizes rounds that have a nonzero value, so you can use as many rounds as you wish, from 1 to 6. The DMG suggests using 3, but I have found that in certain circumstances, more are necessary to get an accurate simulation.</p><p>You can use whatever method you think makes the most sense for how to accurately represent the creature's damage output throughout the fight, though the guidelines in the DMG specify that you should use the following 'rules' when determining this total:</p><ul><li>Always use the average damage for any given damage expression (i.e. use 3 for 1d6, 9 for 2d8, 11 for 2d8 + 2, etc.).</li><li>Assume every attack hits its target, and that the target fails its save for any additional damage and/or effect.</li><li>If the attack or effect has an area of effect, assume that it targets two creatures, and that both fail their saves.</li><li>If an action or effect recharges according to a d6 roll (e.g. 'Recharge 4&ndash;6'), assume the average number of rounds it will take to recharge: two rounds for 4&ndash;6, three rounds for 5&ndash;6, or six rounds for 6.</ul><p>Then, set the save DC that the creature's enemies will need to roll against most often to avoid its effects. If the creature has no abilities or effects that require a save, you can simply set this number to zero.</p><h2><i>Step 4: Traits, Etc.</i></h2><p>Simply check the boxes for any relevant traits or attributes that apply to the creature. You'll notice that this list is far from exhaustive, this is because the vast majority of traits either have no effect on the creature's CR (per the DMG), or serve only to provide an extra attack, or to deal extra damage, in which case you would increase the creature's damage output in the calculator as makes sense for that trait or ability. Click the 'Where are the rest of the traits?' line to learn more. Additionally, you can hover over any of the listed traits to see a brief description or explanation of that trait and/or its effects on the creature's CR.</p><p><b>Special Note:</b> be aware that the damage resistances and immunities check boxes should only be checked <i>if the damage types are ones that aren't likely to be easily bypassed.</i> For example, you should check these boxes for resistance or immunity to nonmagical bludgeoning, piercing, or slashing damage, or perhaps even for fire, force, lightning, or some other common magic damage type. However, resistance or immunity to something like poison damage is common enough among monsters and rare enough among spells and class abilities that it won't likely make a significant impact on the creature's difficulty in actual use.</p><h2><i>The Final Result</i></h2><p>Once this is all done, you can check the final result at the very bottom, where it says 'Overall CR' (The smaller number in parentheses is the final CR result before rounding).</p><h2><i>Optional: Spell Calculator</i></h2><p>Also included is a spell calculator. In order to use it, fill out the level of your monster's top 3 available spell slots, the caster level of the monster and select the spells it has available to it. If a spell is not in the list, it's because it does not use an action to deal direct damage. For such spells, like for example <i>Hex</i>, you have to manually calculate if the spell affects the damage output of the monster.</p><p>Whenever a value is changed the spell calculator will fill out the damage per turn the spells produce, and for transparency, list what spells were used to get to those numbers.</p><p>Finally, if you wish to transfer those calculated numbers to the CR calculator, press <i>Transfer</i>. <b>Warning:</b> Any values in the damage form of the CR calculator will be replaced by the spell calculator numbers.</p><p><b>Assumptions.</b> Spells that hit more than one creature is assumed to hit two creatures for calculating damage. Damage over time effects that rely on concentration, a failed save each turn or an action to douse it, is assumed to get one extra tick of damage before disappearing.</b></p><small><i>(Click anywhere to close)</i></small></div>")}}function promptN(e){return window.prompt("Roll Xd"+e+"; X=",1)}function roundCR(e,t=!1){return 1<=e?t?Math.round(e).toString():Math.round(e):.5<=e?t?Math.round(2*e)/2==.5?"&frac12;":"1":Math.round(2*e)/2:.25<=e?t?Math.round(4*e)/4==.25?"&frac14;":"&frac12;":Math.round(4*e)/4:.125<=e?t?Math.round(8*e)/8==.125?"&frac18;":"&frac14;":Math.round(8*e)/8:t?Math.round(8*e)/8==.125?"&frac18;":"0":Math.round(8*e)/8}function DCRbyHP(e){return(statsTableMap=getStatsTableMap()).dcrByHP(e)}function ACforHPCR(e){return(statsTableMap=getStatsTableMap()).acForHPCR(e,Math.floor(math.evaluate(document.getElementById("actualAC").value)))}function OCRbyDmg(e){return(statsTableMap=getStatsTableMap()).ocrByDmg(e)}function AttforDmgCR(e){return(statsTableMap=getStatsTableMap()).attForDmgCR(e,parseInt(document.getElementById("actualAB").value))}function SDCforDmgCR(e){return(statsTableMap=getStatsTableMap()).sdcForDmgCR(e,parseInt(document.getElementById("actualAB").value))}function Validate(){try{math.evaluate(document.getElementById("actualAC").value)<1&&(document.getElementById("actualAC").value=1)}catch(e){document.getElementById("actualAC").value=1}parseInt(document.getElementById("savingThrowProficiencyCount").value)<0&&(document.getElementById("savingThrowProficiencyCount").value=0),6<parseInt(document.getElementById("savingThrowProficiencyCount").value)&&(document.getElementById("savingThrowProficiencyCount").value=6);try{math.evaluate(untangleDiceExpression(document.getElementById("actualHP").value))<1&&(document.getElementById("actualHP").value=1)}catch(e){document.getElementById("actualHP").value=1}parseInt(document.getElementById("actualAB").value)<0&&(document.getElementById("actualAB").value=0);try{math.evaluate(untangleDiceExpression(document.getElementById("pDmg1").value))<0&&(document.getElementById("pDmg1").value=0)}catch(e){document.getElementById("pDmg1").value=0}try{math.evaluate(untangleDiceExpression(document.getElementById("pDmg2").value))<0&&(document.getElementById("pDmg2").value=0)}catch(e){document.getElementById("pDmg2").value=0}try{math.evaluate(untangleDiceExpression(document.getElementById("pDmg3").value))<0&&(document.getElementById("pDmg3").value=0)}catch(e){document.getElementById("pDmg3").value=0}try{math.evaluate(untangleDiceExpression(document.getElementById("pDmg4").value))<0&&(document.getElementById("pDmg4").value=0)}catch(e){document.getElementById("pDmg4").value=0}try{math.evaluate(untangleDiceExpression(document.getElementById("pDmg4").value))<0&&(document.getElementById("pDmg4").value=0)}catch(e){document.getElementById("pDmg4").value=0}try{math.evaluate(untangleDiceExpression(document.getElementById("pDmg5").value))<0&&(document.getElementById("pDmg5").value=0)}catch(e){document.getElementById("pDmg5").value=0}parseInt(document.getElementById("actualSDC").value)<1&&(document.getElementById("actualSDC").value=1),parseInt(document.getElementById("legendaryResistanceUses").value)<1&&(document.getElementById("legendaryResistanceUses").value=1),parseInt(document.getElementById("regenerationValue").value)<1&&(document.getElementById("regenerationValue").value=1)}function TransformToTableValue(e){return-3==e?0:-2==e?.125:-1==e?.25:0==e?.5:e}function Calculate(){Validate(),statsTableMap=getStatsTableMap(),cr0Stats=statsTableMap.get(-3),document.getElementById("-3pb").innerHTML="+"+cr0Stats.profBonus,document.getElementById("-3ac").innerHTML="&le;"+cr0Stats.armorClass,document.getElementById("-3hp").innerHTML=cr0Stats.hitPointsMin+"&ndash;"+cr0Stats.hitPointsMax,document.getElementById("-3ab").innerHTML="&le;+"+cr0Stats.attackBonus,document.getElementById("-3dmg").innerHTML=cr0Stats.damagePerRoundMin+"&ndash;"+cr0Stats.damagePerRoundMax,document.getElementById("-3dc").innerHTML="&le;"+cr0Stats.saveDC;for(let e=-2;e<31;e++)stats=statsTableMap.get(e),document.getElementById(e+"pb").innerHTML="+"+stats.profBonus,document.getElementById(e+"ac").innerHTML=stats.armorClass,document.getElementById(e+"hp").innerHTML=stats.hitPointsMin+"&ndash;"+stats.hitPointsMax,document.getElementById(e+"ab").innerHTML="+"+stats.attackBonus,document.getElementById(e+"dmg").innerHTML=stats.damagePerRoundMin+"&ndash;"+stats.damagePerRoundMax,document.getElementById(e+"dc").innerHTML=stats.saveDC;var e=1,t=("0-4"==document.getElementById("targetCR").value?e=1:"5-10"==document.getElementById("targetCR").value?e=2:"11-16"==document.getElementById("targetCR").value?e=3:"17p"==document.getElementById("targetCR").value&&(e=4),Math.floor(math.evaluate(document.getElementById("actualAC").value))),n=document.getElementById("effectiveAC"),a=(document.getElementById("flySpeedAndRangedAttack").checked&&e<=2&&(t+=2),document.getElementById("savingThrowProficiencyCount").disabled=!0,document.getElementById("savingThrowProficiencies").checked&&(document.getElementById("savingThrowProficiencyCount").disabled=!1,3<=(d=parseInt(document.getElementById("savingThrowProficiencyCount").value))&&(t+=2),5<=d)&&(t+=2),document.getElementById("avoidance").checked&&(t+=1),document.getElementById("constrict").checked&&(t+=1),document.getElementById("magicResistance").checked&&(t+=2),document.getElementById("nimbleEscape").checked&&(t+=4),document.getElementById("parry").checked&&(t+=1),document.getElementById("shadowStealth").checked&&(t+=4),document.getElementById("stench").checked&&(t+=1),document.getElementById("superiorInvisibility").checked&&(t+=2),document.getElementById("web").checked&&(t+=1),n.innerHTML=t,Math.floor(math.evaluate(untangleDiceExpression(document.getElementById("actualHP").value)))),d=a,n=document.getElementById("effectiveHP"),c=1;switch(e){case 1:(document.getElementById("damageResistance").checked||document.getElementById("damageImmunity").checked)&&(c=2);break;case 2:document.getElementById("damageResistance").checked&&(c=1.5),document.getElementById("damageImmunity").checked&&(c=2);break;case 3:document.getElementById("damageResistance").checked&&(c=1.25),document.getElementById("damageImmunity").checked&&(c=1.5);break;case 4:document.getElementById("damageImmunity").checked&&(c=1.25)}if(document.getElementById("damageTransfer").checked&&(c+=1),(document.getElementById("frightfulPresence").checked||document.getElementById("horrifyingVisage").checked)&&e<=2&&(c+=.25),document.getElementById("possession").checked&&(c+=1),a=Math.floor(a*c),document.getElementById("legendaryResistanceUses").disabled=!0,document.getElementById("legendaryResistance").checked){document.getElementById("legendaryResistanceUses").disabled=!1;var o=parseInt(document.getElementById("legendaryResistanceUses").value);switch(e){case 1:a+=10*o;break;case 2:a+=20*o;break;case 3:case 4:a+=30*o}}document.getElementById("regenerationValue").disabled=!0,document.getElementById("regeneration").checked&&(document.getElementById("regenerationValue").disabled=!1,a+=3*parseInt(document.getElementById("regenerationValue").value)),document.getElementById("relentless").checked&&(a+=7*e),document.getElementById("undeadFortitude").checked&&(a+=7*e),n.innerHTML=d!==a?a+` (${d})`:a;var n=parseInt(document.getElementById("actualAB").value),d=document.getElementById("effectiveAB"),d=(document.getElementById("ambusher").checked&&(n+=1),document.getElementById("bloodFrenzy").checked&&(n+=4),document.getElementById("nimbleEscape").checked&&(n+=4),document.getElementById("packTactics").checked&&(n+=1),d.innerHTML="+"+n,0),l=0,m=0,s=0,u=(document.getElementById("aggressive").checked&&(l=2),document.getElementById("damageTransfer").checked&&(m=Math.floor(Math.round(math.evaluate(untangleDiceExpression(document.getElementById("actualHP").value)))/3)),document.getElementById("rampage").checked&&(s=2),Math.floor(math.evaluate(untangleDiceExpression(document.getElementById("pDmg1").value)))),r=(0<u?(u+=l+m+s,d++):u=0,document.getElementById("rndDmg1").innerHTML=u,Math.floor(math.evaluate(untangleDiceExpression(document.getElementById("pDmg2").value)))),i=(0<r?(r+=l+m+s,d++):r=0,document.getElementById("rndDmg2").innerHTML=r,Math.floor(math.evaluate(untangleDiceExpression(document.getElementById("pDmg3").value)))),g=(0<i?(i+=l+m+s,d++):i=0,document.getElementById("rndDmg3").innerHTML=i,Math.floor(math.evaluate(untangleDiceExpression(document.getElementById("pDmg4").value)))),h=(0<g?(g+=l+m+s,d++):g=0,document.getElementById("rndDmg4").innerHTML=g,Math.floor(math.evaluate(untangleDiceExpression(document.getElementById("pDmg5").value)))),y=(0<h?(h+=l+m+s,d++):h=0,document.getElementById("rndDmg5").innerHTML=h,Math.floor(math.evaluate(untangleDiceExpression(document.getElementById("pDmg6").value)))),m=(0<y?(y+=l+m+s,d++):y=0,document.getElementById("rndDmg6").innerHTML=y,document.getElementById("nRounds").innerHTML=d<=1?"1 round":d+" rounds",l=u+r+i+g+h+y),m=0<d?Math.round(l/d):0,s=(document.getElementById("avgDmg").innerHTML=m,!0===document.getElementById("legendaryDragon").checked&&document.getElementById("2024Table").checked&&(m=Math.round(.8*m)),document.getElementById("dmgPerRound").innerHTML=m,parseInt(document.getElementById("actualSDC").value)),u=(document.getElementById("effectiveSDC").innerHTML=s,DCRbyHP(a)),r=ACforHPCR(u),i=u,g="",g=-3==u?t>cr0Stats.armorClass+1?(i+=Math.floor(Math.abs(t-cr0Stats.armorClass)/2)," (+"+Math.floor(Math.abs(t-cr0Stats.armorClass)/2)+" CR)"):" (+0 CR)":-2<t-r?(i+=Math.floor(Math.abs(t-r)/2)," (+"+Math.floor(Math.abs(t-r)/2)+" CR)"):(i-=Math.floor(Math.abs(t-r)/2)," (-"+Math.floor(Math.abs(t-r)/2)+" CR)"),h=(i<-3&&(i=-3),document.getElementById("CRbyHP").innerHTML=roundCR(TransformToTableValue(u),!0),document.getElementById("HPCRAC").innerHTML=-3==u?`&le;${cr0Stats.armorClass}<br/><span class='smallAddendum'>`+g+"</span>":r+"<br/><span class='smallAddendum'>"+g+"</span>",document.getElementById("defensiveCR").innerHTML=roundCR(TransformToTableValue(i),!0)+"<br/><span class='smallAddendum'>("+TransformToTableValue(i)+")</span>",OCRbyDmg(m)),y=AttforDmgCR(h),l=SDCforDmgCR(h),d=h,t=h,u=h,r="",g="",r=-3==h?n>cr0Stats.attackBonus+1?(t+=Math.floor(Math.abs(n-cr0Stats.attackBonus)/2)," (+"+Math.floor(Math.abs(n-cr0Stats.attackBonus)/2)+" CR)"):" (+0 CR)":-2<n-y?(t+=Math.floor(Math.abs(n-y)/2)," (+"+Math.floor(Math.abs(n-y)/2)+" CR)"):(t-=Math.floor(Math.abs(n-y)/2)," (-"+Math.floor(Math.abs(n-y)/2)+" CR)"),g=-3==h?s>cr0Stats.attackBonus+1?(u+=Math.floor(Math.abs(s-cr0Stats.saveDC)/2)," (+"+Math.floor(Math.abs(s-cr0Stats.saveDC)/2)+" CR)"):" (+0 CR)":-2<s-l?(u+=Math.floor(Math.abs(s-l)/2)," (+"+Math.floor(Math.abs(s-l)/2)+" CR)"):(u-=Math.floor(Math.abs(s-l)/2)," (-"+Math.floor(Math.abs(s-l)/2)+" CR)"),m=(u<=t?(d=t,document.getElementById("offensiveCRbyAtt").style.color="#000",document.getElementById("offensiveCRbyAttLabel").style.color="#000",document.getElementById("offensiveCRbySDC").style.color="#666",document.getElementById("offensiveCRbySDCLabel").style.color="#666"):(d=u,document.getElementById("offensiveCRbyAtt").style.color="#666",document.getElementById("offensiveCRbyAttLabel").style.color="#666",document.getElementById("offensiveCRbySDC").style.color="#000",document.getElementById("offensiveCRbySDCLabel").style.color="#000"),d<-3&&(d=-3),document.getElementById("CRbyDmg").innerHTML=roundCR(TransformToTableValue(h),!0)+"<br/><span class='smallAddendum'>("+TransformToTableValue(h)+")</span>",-3==h?(document.getElementById("DmgCRAtt").innerHTML=`&le;+${cr0Stats.attackBonus}<br/><span class='smallAddendum'>`+r+"</span>",document.getElementById("DmgCRSDC").innerHTML=`&le;${cr0Stats.saveDC}<br/><span class='smallAddendum'>`+g+"</span>"):(document.getElementById("DmgCRAtt").innerHTML="+"+y+"<br/><span class='smallAddendum'>"+r+"</span>",document.getElementById("DmgCRSDC").innerHTML=l+"<br/><span class='smallAddendum'>"+g+"</span>"),document.getElementById("offensiveCRbyAtt").innerHTML=roundCR(TransformToTableValue(t),!0)+"<br/><span class='smallAddendum'>("+TransformToTableValue(t)+")</span>",document.getElementById("offensiveCRbySDC").innerHTML=roundCR(TransformToTableValue(u),!0)+"<br/><span class='smallAddendum'>("+TransformToTableValue(u)+")</span>",document.getElementById("finalCR").innerHTML=roundCR((TransformToTableValue(i)+TransformToTableValue(d))/2,!0)+"<br/><span class='lessSmallAddendum'>("+(TransformToTableValue(i)+TransformToTableValue(d))/2+")</span>",document.getElementById("targetCRCell")),n=roundCR((TransformToTableValue(i)+TransformToTableValue(d))/2);m.style.backgroundColor=1==e&&4<n||2==e&&(n<5||10<n)||3==e&&(n<11||16<n)||4==e&&n<17?"yellow":"white",history.pushState({},"WC5e CR Calculator","?"+generateUrl())}